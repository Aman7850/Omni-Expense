{"version":3,"sources":["BottomSheetModalProvider.tsx"],"names":["React","useCallback","useMemo","useRef","useState","PortalProvider","BottomSheetModalProvider","BottomSheetModalInternalProvider","BottomSheetContainer","WINDOW_HEIGHT","BottomSheetModalProviderWrapper","children","containerHeight","setContainerHeight","sheetsQueueRef","handleOnContainerMeasureHeight","height","handleMountSheet","key","ref","_sheetsQueue","current","slice","sheetIndex","findIndex","item","sheetOnTop","length","currentMountedSheet","willUnmount","minimize","splice","restore","push","handleUnmountSheet","hasMinimizedSheet","handleWillUnmountSheet","handleDismiss","sheetToBeDismissed","find","dismiss","handleDismissAll","map","externalContextVariables","dismissAll","internalContextVariables","mountSheet","unmountSheet","willUnmountSheet"],"mappings":"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","sourcesContent":["import React, { useCallback, useMemo, useRef, useState } from 'react';\nimport { PortalProvider } from '@gorhom/portal';\nimport {\n  BottomSheetModalProvider,\n  BottomSheetModalInternalProvider,\n} from '../../contexts';\nimport BottomSheetContainer from '../bottomSheetContainer';\nimport { WINDOW_HEIGHT } from '../../constants';\nimport type {\n  BottomSheetModalProviderProps,\n  BottomSheetModalRef,\n} from './types';\n\nconst BottomSheetModalProviderWrapper = ({\n  children,\n}: BottomSheetModalProviderProps) => {\n  //#region layout state\n  const [containerHeight, setContainerHeight] = useState(WINDOW_HEIGHT);\n  //#endregion\n\n  //#region variables\n  const sheetsQueueRef = useRef<BottomSheetModalRef[]>([]);\n  //#endregion\n\n  //#region callback\n  const handleOnContainerMeasureHeight = useCallback((height: number) => {\n    setContainerHeight(height);\n  }, []);\n  //#endregion\n\n  //#region private methods\n  const handleMountSheet = useCallback((key: string, ref) => {\n    const _sheetsQueue = sheetsQueueRef.current.slice();\n    const sheetIndex = _sheetsQueue.findIndex(item => item.key === key);\n    const sheetOnTop = sheetIndex === _sheetsQueue.length - 1;\n\n    /**\n     * Exit the method, if sheet is already presented\n     * and at the top.\n     */\n    if (sheetIndex !== -1 && sheetOnTop) {\n      return;\n    }\n\n    /**\n     * Minimize the current sheet if:\n     * - it exists.\n     * - it is not unmounting.\n     */\n    const currentMountedSheet = _sheetsQueue[_sheetsQueue.length - 1];\n    if (currentMountedSheet && !currentMountedSheet.willUnmount) {\n      currentMountedSheet.ref.current.minimize();\n    }\n\n    /**\n     * Restore and remove incoming sheet from the queue,\n     * if it was registered.\n     */\n    if (sheetIndex !== -1) {\n      _sheetsQueue.splice(sheetIndex, 1);\n      ref.current.restore();\n    }\n\n    _sheetsQueue.push({\n      key,\n      ref,\n      willUnmount: false,\n    });\n    sheetsQueueRef.current = _sheetsQueue;\n  }, []);\n  const handleUnmountSheet = useCallback((key: string) => {\n    const _sheetsQueue = sheetsQueueRef.current.slice();\n    const sheetIndex = _sheetsQueue.findIndex(item => item.key === key);\n    const sheetOnTop = sheetIndex === _sheetsQueue.length - 1;\n\n    /**\n     * Here we remove the unmounted sheet and update\n     * the sheets queue.\n     */\n    _sheetsQueue.splice(sheetIndex, 1);\n    sheetsQueueRef.current = _sheetsQueue;\n\n    /**\n     * Here we try to restore previous sheet position if unmounted\n     * sheet was on top. This is needed when user dismiss\n     * the modal by panning down.\n     */\n    const hasMinimizedSheet = sheetsQueueRef.current.length > 0;\n    if (sheetOnTop && hasMinimizedSheet) {\n      sheetsQueueRef.current[\n        sheetsQueueRef.current.length - 1\n      ].ref.current.restore();\n    }\n  }, []);\n  const handleWillUnmountSheet = useCallback((key: string) => {\n    const _sheetsQueue = sheetsQueueRef.current.slice();\n    const sheetIndex = _sheetsQueue.findIndex(item => item.key === key);\n    const sheetOnTop = sheetIndex === _sheetsQueue.length - 1;\n\n    /**\n     * Here we mark the sheet that will unmount,\n     * so it won't be restored.\n     */\n    if (sheetIndex !== -1) {\n      _sheetsQueue[sheetIndex].willUnmount = true;\n    }\n\n    /**\n     * Here we try to restore previous sheet position,\n     * This is needed when user dismiss the modal by fire the dismiss action.\n     */\n    const hasMinimizedSheet = _sheetsQueue.length > 1;\n    if (sheetOnTop && hasMinimizedSheet) {\n      _sheetsQueue[_sheetsQueue.length - 2].ref.current.restore();\n    }\n\n    sheetsQueueRef.current = _sheetsQueue;\n  }, []);\n  //#endregion\n\n  //#region public methods\n  const handleDismiss = useCallback((key: string) => {\n    const sheetToBeDismissed = sheetsQueueRef.current.find(\n      item => item.key === key\n    );\n    if (sheetToBeDismissed) {\n      sheetToBeDismissed.ref.current.dismiss(true);\n    }\n  }, []);\n  const handleDismissAll = useCallback(() => {\n    sheetsQueueRef.current.map(item => {\n      item.ref.current.dismiss(true);\n    });\n  }, []);\n  //#endregion\n\n  //#region context variables\n  const externalContextVariables = useMemo(\n    () => ({\n      dismiss: handleDismiss,\n      dismissAll: handleDismissAll,\n    }),\n    [handleDismiss, handleDismissAll]\n  );\n  const internalContextVariables = useMemo(\n    () => ({\n      containerHeight,\n      mountSheet: handleMountSheet,\n      unmountSheet: handleUnmountSheet,\n      willUnmountSheet: handleWillUnmountSheet,\n    }),\n    [\n      containerHeight,\n      handleMountSheet,\n      handleUnmountSheet,\n      handleWillUnmountSheet,\n    ]\n  );\n  //#endregion\n\n  //#region renders\n  return (\n    <BottomSheetModalProvider value={externalContextVariables}>\n      <BottomSheetModalInternalProvider value={internalContextVariables}>\n        <BottomSheetContainer\n          shouldMeasureHeight={true}\n          onMeasureHeight={handleOnContainerMeasureHeight}\n          children={null}\n        />\n        <PortalProvider>{children}</PortalProvider>\n      </BottomSheetModalInternalProvider>\n    </BottomSheetModalProvider>\n  );\n  //#endregion\n};\n\nexport default BottomSheetModalProviderWrapper;\n"]}
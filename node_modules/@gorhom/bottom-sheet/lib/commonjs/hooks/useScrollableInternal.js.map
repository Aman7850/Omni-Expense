{"version":3,"sources":["useScrollableInternal.ts"],"names":["useScrollableInternal","type","scrollableContentHeightRef","scrollableContentOffsetYRef","scrollableContentOffsetY","scrollableRef","_scrollableContentOffsetY","setScrollableRef","removeScrollableRef","handleOnContentSizeChange","_","height","current","setValue","handleOnBeginDragEvent","nativeEvent","contentOffset","y","handleSettingScrollable","id","node","getNode","console","warn","args"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AAGO,MAAMA,qBAAqB,GAAIC,IAAD,IAA0B;AAC7D;AACA,QAAMC,0BAA0B,GAAG,mBAAe,CAAf,CAAnC;AACA,QAAMC,2BAA2B,GAAG,mBAAe,CAAf,CAApC;AACA,QAAMC,wBAAwB,GAAG,iCAAiB,CAAjB,CAAjC;AACA,QAAMC,aAAa,GAAG,mBAAmB,IAAnB,CAAtB,CAL6D,CAO7D;;AACA,QAAM;AACJD,IAAAA,wBAAwB,EAAEE,yBADtB;AAEJC,IAAAA,gBAFI;AAGJC,IAAAA;AAHI,MAIF,qDAJJ,CAR6D,CAc7D;;AACA;;;;;AAIA,QAAMC,yBAAyB,GAAG,wBAChC,CAACC,CAAD,EAAIC,MAAJ,KAAuB;AACrB,QAAIT,0BAA0B,CAACU,OAA3B,GAAqCD,MAAzC,EAAiD;AAC/CP,MAAAA,wBAAwB,CAACS,QAAzB,CAAkC,CAAlC;AACD;;AACDX,IAAAA,0BAA0B,CAACU,OAA3B,GAAqCD,MAArC;AACD,GAN+B,EAOhC,CAACP,wBAAD,CAPgC,CAAlC;AASA,QAAMU,sBAAsB,GAAG,oBAC7B,MACE,kCAAM,CACJ;AACEC,IAAAA,WAAW,EAAE;AACXC,MAAAA,aAAa,EAAE;AAAEC,QAAAA,CAAC,EAAEb;AAAL;AADJ;AADf,GADI,CAAN,CAF2B,EAS7B,CAACA,wBAAD,CAT6B,CAA/B;AAWA,QAAMc,uBAAuB,GAAG,wBAAY,MAAM;AAChDZ,IAAAA,yBAAyB,CAACO,QAA1B,CAAmCV,2BAA2B,CAACS,OAA/D;;AAEA,UAAMO,EAAE,GAAG,iCAAed,aAAa,CAACO,OAA7B,CAAX;;AAEA,QAAIO,EAAJ,EAAQ;AACNZ,MAAAA,gBAAgB,CAAC;AACfY,QAAAA,EAAE,EAAEA,EADW;AAEflB,QAAAA,IAFe;AAGf;AACAmB,QAAAA,IAAI,EAAEf,aAAa,CAACO,OAAd,CAAuBS,OAAvB;AAJS,OAAD,CAAhB;AAMD,KAPD,MAOO;AACLC,MAAAA,OAAO,CAACC,IAAR;AACD;;AAED,WAAO,MAAM;AACXf,MAAAA,mBAAmB,CAACH,aAAD,CAAnB;AACD,KAFD;AAGD,GAnB+B,EAmB7B,CAACJ,IAAD,EAAOK,yBAAP,EAAkCE,mBAAlC,EAAuDD,gBAAvD,CAnB6B,CAAhC,CAvC6D,CA4D7D;;AACA,sCACE,MACE,qCAASH,wBAAT,EAAmC,CACjC,gCAAIE,yBAAJ,EAA+BF,wBAA/B,CADiC,EAEjC,iCAAK,CAACA,wBAAD,CAAL,EAAiCoB,IAAI,IAAI;AACvCrB,IAAAA,2BAA2B,CAACS,OAA5B,GAAsCY,IAAI,CAAC,CAAD,CAA1C;AACD,GAFD,CAFiC,CAAnC,CAFJ,EAQE,EARF;AAWA,SAAO;AACLnB,IAAAA,aADK;AAELS,IAAAA,sBAFK;AAGLL,IAAAA,yBAHK;AAILS,IAAAA;AAJK,GAAP;AAMD,CA9EM","sourcesContent":["import { useCallback, useRef, useMemo } from 'react';\nimport { findNodeHandle } from 'react-native';\nimport { event, useCode, onChange, set, call } from 'react-native-reanimated';\nimport { useValue } from 'react-native-redash';\nimport { useBottomSheetInternal } from '../hooks/useBottomSheetInternal';\nimport type { Scrollable, ScrollableType } from '../types';\n\nexport const useScrollableInternal = (type: ScrollableType) => {\n  // refs\n  const scrollableContentHeightRef = useRef<number>(0);\n  const scrollableContentOffsetYRef = useRef<number>(0);\n  const scrollableContentOffsetY = useValue<number>(0);\n  const scrollableRef = useRef<Scrollable>(null);\n\n  // hooks\n  const {\n    scrollableContentOffsetY: _scrollableContentOffsetY,\n    setScrollableRef,\n    removeScrollableRef,\n  } = useBottomSheetInternal();\n\n  // callbacks\n  /**\n   * Reset the scrollable offset y when its size get smaller,\n   * this fixes #286.\n   */\n  const handleOnContentSizeChange = useCallback(\n    (_, height: number) => {\n      if (scrollableContentHeightRef.current > height) {\n        scrollableContentOffsetY.setValue(0);\n      }\n      scrollableContentHeightRef.current = height;\n    },\n    [scrollableContentOffsetY]\n  );\n  const handleOnBeginDragEvent = useMemo(\n    () =>\n      event([\n        {\n          nativeEvent: {\n            contentOffset: { y: scrollableContentOffsetY },\n          },\n        },\n      ]),\n    [scrollableContentOffsetY]\n  );\n  const handleSettingScrollable = useCallback(() => {\n    _scrollableContentOffsetY.setValue(scrollableContentOffsetYRef.current);\n\n    const id = findNodeHandle(scrollableRef.current);\n\n    if (id) {\n      setScrollableRef({\n        id: id,\n        type,\n        // @ts-ignore\n        node: scrollableRef.current!.getNode(),\n      });\n    } else {\n      console.warn(`Couldn't find the scrollable node handle id!`);\n    }\n\n    return () => {\n      removeScrollableRef(scrollableRef);\n    };\n  }, [type, _scrollableContentOffsetY, removeScrollableRef, setScrollableRef]);\n\n  // effects\n  useCode(\n    () =>\n      onChange(scrollableContentOffsetY, [\n        set(_scrollableContentOffsetY, scrollableContentOffsetY),\n        call([scrollableContentOffsetY], args => {\n          scrollableContentOffsetYRef.current = args[0];\n        }),\n      ]),\n    []\n  );\n\n  return {\n    scrollableRef,\n    handleOnBeginDragEvent,\n    handleOnContentSizeChange,\n    handleSettingScrollable,\n  };\n};\n"]}
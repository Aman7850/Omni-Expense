{"version":3,"sources":["BottomSheetModal.tsx"],"names":["BottomSheetModalComponent","props","ref","name","dismissOnPanDown","DEFAULT_DISMISS_ON_PAN_DOWN","onDismiss","_providedOnDismiss","index","_providedIndex","snapPoints","_providedSnapPoints","onChange","_providedOnChange","topInset","bottomInset","children","bottomSheetProps","mount","setMount","containerHeight","mountSheet","unmountSheet","willUnmountSheet","removePortal","unmountPortal","bottomSheetRef","currentIndexRef","restoreIndexRef","minimized","forcedDismissed","mounted","key","safeContainerHeight","resetVariables","current","adjustIndex","_index","unmount","_mounted","handleSnapTo","snapTo","handleExpand","expand","handleCollapse","collapse","handleClose","close","handlePresent","requestAnimationFrame","handleDismiss","handleMinimize","handleRestore","handlePortalOnUnmount","handleBottomSheetOnChange","adjustedIndex","present","dismiss","minimize","restore","BottomSheetModal","isEqual"],"mappings":"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","sourcesContent":["import React, {\n  forwardRef,\n  memo,\n  useCallback,\n  useImperativeHandle,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport { Portal, usePortal } from '@gorhom/portal';\nimport { nanoid } from 'nanoid/non-secure';\nimport isEqual from 'lodash.isequal';\nimport BottomSheet from '../bottomSheet';\nimport { useBottomSheetModalInternal } from '../../hooks';\nimport { DEFAULT_DISMISS_ON_PAN_DOWN } from './constants';\nimport type { BottomSheetModalMethods } from '../../types';\nimport type { BottomSheetModalProps } from './types';\n\ntype BottomSheetModal = BottomSheetModalMethods;\n\nconst BottomSheetModalComponent = forwardRef<\n  BottomSheetModal,\n  BottomSheetModalProps\n>((props, ref) => {\n  const {\n    // modal props\n    name,\n    dismissOnPanDown = DEFAULT_DISMISS_ON_PAN_DOWN,\n    onDismiss: _providedOnDismiss,\n\n    // bottom sheet props\n    index: _providedIndex = 0,\n    snapPoints: _providedSnapPoints,\n    onChange: _providedOnChange,\n    topInset = 0,\n    bottomInset = 0,\n\n    // components\n    children,\n    ...bottomSheetProps\n  } = props;\n\n  //#region state\n  const [mount, setMount] = useState(false);\n  //#endregion\n\n  //#region hooks\n  const {\n    containerHeight,\n    mountSheet,\n    unmountSheet,\n    willUnmountSheet,\n  } = useBottomSheetModalInternal();\n  const { removePortal: unmountPortal } = usePortal();\n  //#endregion\n\n  //#region refs\n  const bottomSheetRef = useRef<BottomSheet>(null);\n  const currentIndexRef = useRef(-1);\n  const restoreIndexRef = useRef(-1);\n  const minimized = useRef(false);\n  const forcedDismissed = useRef(false);\n  const mounted = useRef(true);\n  //#endregion\n\n  //#region variables\n  const key = useMemo(() => name || `bottom-sheet-modal-${nanoid()}`, [name]);\n  const index = useMemo(\n    () => (dismissOnPanDown ? _providedIndex + 1 : _providedIndex),\n    [_providedIndex, dismissOnPanDown]\n  );\n  const snapPoints = useMemo(\n    () =>\n      dismissOnPanDown ? [0, ..._providedSnapPoints] : _providedSnapPoints,\n    [_providedSnapPoints, dismissOnPanDown]\n  );\n  const safeContainerHeight = useMemo(\n    () => containerHeight - topInset - bottomInset,\n    [containerHeight, topInset, bottomInset]\n  );\n  //#endregion\n\n  //#region private methods\n  const resetVariables = useCallback(() => {\n    currentIndexRef.current = -1;\n    restoreIndexRef.current = -1;\n    minimized.current = false;\n    mounted.current = true;\n    forcedDismissed.current = false;\n  }, []);\n  const adjustIndex = useCallback(\n    (_index: number) => (dismissOnPanDown ? _index - 1 : _index),\n    [dismissOnPanDown]\n  );\n  const unmount = useCallback(() => {\n    const _mounted = mounted.current;\n\n    // reset variables\n    resetVariables();\n\n    // unmount sheet and portal\n    unmountSheet(key);\n    unmountPortal(key);\n\n    // unmount the node, if sheet is still mounted\n    if (_mounted) {\n      setMount(false);\n    }\n\n    // fire `onDismiss` callback\n    if (_providedOnDismiss) {\n      _providedOnDismiss();\n    }\n  }, [key, resetVariables, unmountSheet, unmountPortal, _providedOnDismiss]);\n  //#endregion\n\n  //#region bottom sheet methods\n  const handleSnapTo = useCallback(\n    (_index: number) => {\n      if (minimized.current) {\n        return;\n      }\n\n      bottomSheetRef.current?.snapTo(adjustIndex(_index));\n    },\n    [adjustIndex]\n  );\n  const handleExpand = useCallback(() => {\n    if (minimized.current) {\n      return;\n    }\n    bottomSheetRef.current?.expand();\n  }, []);\n  const handleCollapse = useCallback(() => {\n    if (minimized.current) {\n      return;\n    }\n    if (dismissOnPanDown) {\n      bottomSheetRef.current?.snapTo(1);\n    } else {\n      bottomSheetRef.current?.collapse();\n    }\n  }, [dismissOnPanDown]);\n  const handleClose = useCallback(() => {\n    if (minimized.current) {\n      return;\n    }\n    bottomSheetRef.current?.close();\n  }, []);\n  //#endregion\n\n  //#region bottom sheet modal methods\n  const handlePresent = useCallback(() => {\n    requestAnimationFrame(() => {\n      setMount(true);\n      mountSheet(key, ref);\n    });\n  }, [key, ref, mountSheet]);\n  const handleDismiss = useCallback(() => {\n    /**\n     * if modal is already been dismiss, we exit the method.\n     */\n    if (currentIndexRef.current === -1 && minimized.current === false) {\n      return;\n    }\n\n    if (minimized.current) {\n      unmount();\n      return;\n    }\n    willUnmountSheet(key);\n    forcedDismissed.current = true;\n    bottomSheetRef.current?.close();\n  }, [willUnmountSheet, unmount, key]);\n  const handleMinimize = useCallback(() => {\n    if (minimized.current) {\n      return;\n    }\n    minimized.current = true;\n\n    /**\n     * if modal got minimized before it finish its mounting\n     * animation, we set the `restoreIndexRef` to the\n     * provided index.\n     */\n    if (currentIndexRef.current === -1) {\n      restoreIndexRef.current = index;\n    } else {\n      restoreIndexRef.current = currentIndexRef.current;\n    }\n    bottomSheetRef.current?.close();\n  }, [index]);\n  const handleRestore = useCallback(() => {\n    if (!minimized.current || forcedDismissed.current) {\n      return;\n    }\n    minimized.current = false;\n    bottomSheetRef.current?.snapTo(restoreIndexRef.current);\n  }, []);\n  //#endregion\n\n  //#region callbacks\n  const handlePortalOnUnmount = useCallback(() => {\n    /**\n     * if modal is already been dismiss, we exit the method.\n     */\n    if (currentIndexRef.current === -1 && minimized.current === false) {\n      return;\n    }\n\n    mounted.current = false;\n    forcedDismissed.current = true;\n\n    if (minimized.current) {\n      unmount();\n      return;\n    }\n    willUnmountSheet(key);\n    bottomSheetRef.current?.close();\n  }, [key, unmount, willUnmountSheet]);\n  const handleBottomSheetOnChange = useCallback(\n    (_index: number) => {\n      const adjustedIndex = adjustIndex(_index);\n      currentIndexRef.current = _index;\n\n      if (_providedOnChange) {\n        _providedOnChange(adjustedIndex);\n      }\n\n      if (minimized.current) {\n        return;\n      }\n\n      if (adjustedIndex === -1) {\n        unmount();\n      }\n    },\n    [adjustIndex, unmount, _providedOnChange]\n  );\n  //#endregion\n\n  //#region expose public methods\n  useImperativeHandle(ref, () => ({\n    // sheet\n    snapTo: handleSnapTo,\n    expand: handleExpand,\n    collapse: handleCollapse,\n    close: handleClose,\n    // modal\n    present: handlePresent,\n    dismiss: handleDismiss,\n    // private\n    minimize: handleMinimize,\n    restore: handleRestore,\n  }));\n  //#endregion\n\n  // render\n  return mount ? (\n    <Portal key={key} name={key} handleOnUnmount={handlePortalOnUnmount}>\n      <BottomSheet\n        {...bottomSheetProps}\n        ref={bottomSheetRef}\n        key={key}\n        index={index}\n        snapPoints={snapPoints}\n        animateOnMount={true}\n        topInset={topInset}\n        bottomInset={bottomInset}\n        containerHeight={safeContainerHeight}\n        onChange={handleBottomSheetOnChange}\n        children={children}\n      />\n    </Portal>\n  ) : null;\n});\n\nconst BottomSheetModal = memo(BottomSheetModalComponent, isEqual);\n\nexport default BottomSheetModal;\n"]}